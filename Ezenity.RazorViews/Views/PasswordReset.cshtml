@using System
@model IDictionary<string, string>

    @{
    string Get(string key, string fallback = "")
        => Model != null && Model.TryGetValue(key, out var v) && !string.IsNullOrWhiteSpace(v) ? v : fallback;

    var appName = Get("appName", "Ezenity");
    var firstName = Get("firstName", "there");
    var year = Get("currentYear", DateTime.UtcNow.Year.ToString());

    // Prefer resetUrl, but support your old key names as fallbacks:
    var resetUrl = Get("resetUrl", Get("actionUrl", Get("verificationUrl", "")));

    var bodyContent = Get("bodyContent",
        $"We received a request to reset the password for your {appName} account. If this was you, click the button below.");

    var supportEmail = Get("supportEmail", $"support@{appName.ToLowerInvariant()}.com");
    var title = Get("templateTitle", "Reset your password");
    }

    <!doctype html>
    <html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="x-apple-disable-message-reformatting" />
        <title>@title</title>
    </head>
    <body style="margin:0;padding:0;background-color:#f4f4f4;">
        <div style="display:none;max-height:0;overflow:hidden;opacity:0;color:transparent;">
            Reset the password for your @appName account.
        </div>

        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color:#f4f4f4;">
            <tr>
                <td align="center" style="padding:24px;">
                    <table role="presentation" width="600" cellpadding="0" cellspacing="0"
                           style="width:600px;max-width:600px;background:#ffffff;border-radius:8px;overflow:hidden;">
                        <tr>
                            <td style="padding:20px 24px;background:#111827;color:#ffffff;font-family:Arial,Helvetica,sans-serif;">
                                <div style="font-size:16px;font-weight:700;">@appName</div>
                                <div style="font-size:12px;opacity:0.9;margin-top:6px;">@title</div>
                            </td>
                        </tr>

                        <tr>
                            <td style="padding:24px;font-family:Arial,Helvetica,sans-serif;color:#111;font-size:14px;line-height:20px;">
                                <p style="margin:0 0 12px 0;">Hello @firstName,</p>

                                <p style="margin:0 0 16px 0;">@bodyContent</p>

                                @if (!string.IsNullOrWhiteSpace(resetUrl))
              {
                                <table role="presentation" cellpadding="0" cellspacing="0" style="margin:16px 0;">
                                    <tr>
                                        <td bgcolor="#2563eb" style="border-radius:6px;">
                                            <a href="@resetUrl"
                                               style="display:inline-block;padding:12px 18px;font-family:Arial,Helvetica,sans-serif;font-size:14px;color:#ffffff;text-decoration:none;font-weight:700;">
                                                Reset password
                                            </a>
                                        </td>
                                    </tr>
                                </table>

                                <p style="margin:0 0 8px 0;color:#444;">
                                    If the button doesn’t work, copy and paste this link into your browser:
                                </p>
                                <p style="margin:0;word-break:break-all;">
                                    <a href="@resetUrl" style="color:#2563eb;text-decoration:underline;">@resetUrl</a>
                                </p>
              }

                                <p style="margin:16px 0 0 0;color:#666;font-size:12px;line-height:18px;">
                                    If you didn’t request a password reset, you can safely ignore this email. Need help? Contact @supportEmail.
                                </p>
                            </td>
                        </tr>

                        <tr>
                            <td style="padding:14px 24px;background:#f9fafb;color:#6b7280;font-family:Arial,Helvetica,sans-serif;font-size:12px;">
                                © @appName @year — Automated message, please do not reply.
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </body>
</html>
